name: GNOME Desktop RDP

on:
  workflow_dispatch:

jobs:
  desktop:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
      - name: Install GNOME Desktop
        run: |
          sudo apt-get update
          sudo apt-get install -y ubuntu-desktop gnome-session gdm3 tigervnc-standalone-server dbus-x11
          
      - name: Setup VNC
        run: |
          mkdir -p ~/.vnc
          echo "github123" | vncpasswd -f > ~/.vnc/passwd
          chmod 600 ~/.vnc/passwd
          
          cat > ~/.vnc/xstartup << 'EOF'
          #!/bin/bash
          unset SESSION_MANAGER
          unset DBUS_SESSION_BUS_ADDRESS
          export DISPLAY=:1
          export XDG_SESSION_TYPE=x11
          export GNOME_SHELL_SESSION_MODE=ubuntu
          
          eval $(dbus-launch --sh-syntax)
          
          gnome-session &
          EOF
          
          chmod +x ~/.vnc/xstartup
          
      - name: Start VNC Server
        run: |
          vncserver :1 -geometry 1920x1080 -depth 24
          echo "VNC Server started!"
          
      - name: Setup Bore Tunnel
        run: |
          wget -q https://github.com/ekzhang/bore/releases/download/v0.5.0/bore-v0.5.0-x86_64-unknown-linux-musl.tar.gz
          tar -xzf bore-v0.5.0-x86_64-unknown-linux-musl.tar.gz
          
          echo "========================================"
          echo "ğŸ”‘ VNC Password: github123"
          echo "ğŸ“ Resolution: 1920x1080"
          echo "ğŸ–¥ï¸  Desktop: GNOME"
          echo "========================================"
          echo ""
          echo "â³ Starting tunnel... Look for bore.pub:XXXXX"
          echo ""
          
          ./bore local 5901 --to bore.pub

name: macOS Desktop

on:
  workflow_dispatch:

jobs:
  macos:
    runs-on: macos-26
    timeout-minutes: 360
    
    steps:
      - name: System Info
        run: |
          echo "=== macOS Info ==="
          sw_vers
          echo ""
          echo "=== CPU ==="
          sysctl -n machdep.cpu.brand_string
          echo ""
          echo "=== Memory ==="
          system_profiler SPHardwareDataType | grep Memory
          
      - name: Enable Screen Sharing (VNC)
        run: |
          # Set VNC password
          echo "github123" | sudo /usr/bin/dscl . -passwd /Users/runner
          
          # Enable Screen Sharing
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart \
            -activate -configure -access -on \
            -restart -agent -privs -all
          
          # Enable VNC
          sudo defaults write /var/db/launchd.db/com.apple.launchd/overrides.plist com.apple.screensharing -dict Disabled -bool false
          sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.screensharing.plist 2>/dev/null || true
          
          echo "Screen Sharing enabled!"
          
      - name: Download Bore
        run: |
          # Download bore for macOS
          curl -sL https://github.com/ekzhang/bore/releases/download/v0.5.0/bore-v0.5.0-x86_64-apple-darwin.tar.gz -o bore.tar.gz
          tar -xzf bore.tar.gz
          chmod +x bore
          
      - name: Start Bore Tunnel
        run: |
          echo "========================================"
          echo "üçé macOS Remote Desktop"
          echo "========================================"
          echo ""
          echo "üîë VNC Password: github123"  
          echo "üë§ Username: runner"
          echo ""
          echo "‚è≥ Starting tunnel on port 5900..."
          echo "üì∫ Look for: bore.pub:XXXXX"
          echo ""
          echo "========================================"
          
          ./bore local 5900 --to bore.pub

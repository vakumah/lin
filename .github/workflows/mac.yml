name: macOS Desktop

on:
  workflow_dispatch:

jobs:
  macos:
    runs-on: macos-26
    timeout-minutes: 360
    
    steps:
      - name: System Info
        run: |
          echo "=== macOS Info ==="
          sw_vers
          echo ""
          echo "=== CPU ==="
          sysctl -n machdep.cpu.brand_string || echo "Apple Silicon"
          echo ""
          echo "=== Memory ==="
          system_profiler SPHardwareDataType | grep Memory
          
      - name: Install VNC Server
        run: |
          # Install TigerVNC via Homebrew
          brew install tiger-vnc
          
      - name: Setup VNC
        run: |
          mkdir -p ~/.vnc
          
          # Set VNC password
          echo "github123" | vncpasswd -f > ~/.vnc/passwd
          chmod 600 ~/.vnc/passwd
          
          # Create xstartup (basic - macOS finder)
          cat > ~/.vnc/xstartup << 'EOF'
          #!/bin/bash
          export DISPLAY=:1
          open -a Finder
          EOF
          chmod +x ~/.vnc/xstartup
          
      - name: Start VNC Server
        run: |
          # Start VNC with TigerVNC
          vncserver :1 -geometry 1920x1080 -depth 24 -localhost no || echo "VNC may already be running"
          echo "VNC Server started!"
          
      - name: Download Bore
        run: |
          curl -sL https://github.com/ekzhang/bore/releases/download/v0.5.0/bore-v0.5.0-x86_64-apple-darwin.tar.gz -o bore.tar.gz
          tar -xzf bore.tar.gz
          chmod +x bore
          
      - name: Start Tunnel
        run: |
          echo "========================================"
          echo "ğŸ macOS Remote Desktop Ready!"
          echo "========================================"
          echo ""
          echo "ğŸ”‘ VNC Password: github123"
          echo "ï¿½ Resolution: 1920x1080"
          echo ""
          echo "â³ Starting tunnel..."
          echo "ğŸ“º Connect to: bore.pub:XXXXX"
          echo ""
          echo "========================================"
          
          ./bore local 5901 --to bore.pub
